<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Check Chapel Status</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="Chapel.css" rel="stylesheet" >
<link href="//cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">

<script
			  src="https://code.jquery.com/jquery-3.4.1.min.js"
			  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
			  crossorigin="anonymous"></script>
			  
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>

</head>
<body onload="loadPage()">
	<div id="container">
		<div id="header"><div id="logo"></div></div>
	<div id="content">
	<table cellspacing="0" cellpadding="0">
		<tbody>
			<tr>
				<td style="vertical-align: top;" align="left">
					<table cellspacing="0" cellpadding="0">
						<tbody>
							<tr>
								<td style="vertical-align: top;" align="left"><div>
										<table class="gwt-TabPanelBottom"
											style="width: 679px; height: 442px;" cellspacing="0"
											cellpadding="0">
											<tbody>
												<tr>
													<td style="vertical-align: top;" align="left"><div
															class="title">Chapel Attendance</div></td>
												</tr>
												<tr>
													<td style="vertical-align: top;" align="left"><div
														class="title">For <span th:text="${fullname}"/>  <span id="campusId" th:text="${campusId}"/></div></td>
														
												</tr>
												<tr>
													<td style="vertical-align: top;" align="left">
														<table cellspacing="0" cellpadding="0" class="totals">
															<tbody>
																<tr>
																	<td style="vertical-align: top;" align="left"><div
																			class="gwt-Label" style="width: 127px;">Total:
																			<span id="total" th:text="${total}"/></div></td>
																</tr>
																<tr>
																	<td style="vertical-align: top;" align="left"><div
																			class="pad">Goal: <span id="goal" th:text="${goal}"/></div></td>
																</tr>
																<tr>
																	<td style="vertical-align: top;" align="left"><div
																			class="pad">Present: <span id="present_sum" th:text="${present}"/></div></td>
																</tr>
																<tr>
																	<td style="vertical-align: top;" align="left"><div
																			class="pad">Tardy: <span id="tardy_sum" th:text="${tardy}"/></div></td>
																</tr>
															</tbody>
														</table>
													</td>
												</tr>
												<tr>
													<td style="vertical-align: top;" align="left">
													<table style="height: 450px;" cellspacing="0" cellpadding="0" >
														<colgroup>
															<col style="width: 50%;">
															<col style="width: 50%;">
														</colgroup>
															<tbody>
																<tr>
																	<td style="vertical-align: top;" align="left">
																		<table cellspacing="0" cellpadding="0" class="gridTable">
																			<tbody >
																				<tr>
																					<td style="vertical-align: top;" align="left">
																						<table id="present" 
																							__gwtcellbasedwidgetimpldispatchingfocus="true"
																							__gwtcellbasedwidgetimpldispatchingblur="true"
																							class="display stripe"
																							cellspacing="0">
																							<colgroup>
																								<col style="width: 50%;">
																								<col style="width: 50%;">
																							</colgroup>
																							<thead>
																								<tr __gwt_header_row="0">
																									<th colspan="1"
																										class="header firstHeader"
																										__gwt_column="column-gwt-uid-13"
																										__gwt_header="header-gwt-uid-14">Dates&nbsp;Present</th>
																									<th colspan="1"
																										class="header lastHeader"
																										__gwt_column="column-gwt-uid-15"
																										__gwt_header="header-gwt-uid-16">Credit</th>
																								</tr>
																							</thead>
																							<tbody style="">
																								<tr th:each="present: ${present_dates}" __gwt_row="0" __gwt_subrow="0" class="evenRow">
																									<td class="cell oddCell firstColumn">
																										<div style="outline-style: none;"
																											__gwt_cell="cell-gwt-uid-17" tabindex="0">
																												<span th:text="${present.get('day')}"/></div></td>
																									<td class="cell evenCell lastColumn">
																										<div style="outline-style: none;"
																											__gwt_cell="cell-gwt-uid-18">
																											<span th:text="${present.get('value')}"/></div></td>
																								</tr>
																							</tbody>
																							<tbody style="display: none;">
																								<tr>
																									<td colspan="2" align="center"><div>
																											<div
																												style="width: 100%; height: 100%; padding: 0px; margin: 0px; display: none;"
																												aria-hidden="true">
																												<div
																													style="width: 100%; height: 100%; display: none;"
																													aria-hidden="true"></div>
																											</div>
																											<div
																												style="width: 100%; height: 100%; padding: 0px; margin: 0px;">
																												<div style="width: 100%; height: 100%;"
																													class="com-google-gwt-user-cellview-client-CellTable-Style-cellTableLoading">
																													<img
																														src="data:image/gif;base64,R0lGODlhKwALAPEAAP///0tKSqampktKSiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAKwALAAACMoSOCMuW2diD88UKG95W88uF4DaGWFmhZid93pq+pwxnLUnXh8ou+sSz+T64oCAyTBUAACH5BAkKAAAALAAAAAArAAsAAAI9xI4IyyAPYWOxmoTHrHzzmGHe94xkmJifyqFKQ0pwLLgHa82xrekkDrIBZRQab1jyfY7KTtPimixiUsevAAAh+QQJCgAAACwAAAAAKwALAAACPYSOCMswD2FjqZpqW9xv4g8KE7d54XmMpNSgqLoOpgvC60xjNonnyc7p+VKamKw1zDCMR8rp8pksYlKorgAAIfkECQoAAAAsAAAAACsACwAAAkCEjgjLltnYmJS6Bxt+sfq5ZUyoNJ9HHlEqdCfFrqn7DrE2m7Wdj/2y45FkQ13t5itKdshFExC8YCLOEBX6AhQAADsAAAAAAAAAAAA="
																														class="gwt-Image" width="43" height="11">
																												</div>
																											</div>
																										</div></td>
																								</tr>
																							</tbody>
																							<tfoot style="display: none;" aria-hidden="true"></tfoot>
																						</table>
																					</td>
																				</tr>
																			</tbody>
																		</table>
																	</td>
																	<td style="vertical-align: top;" align="left">
																		<table cellspacing="0" cellpadding="0" class="gridTable">
																			<tbody>
																				<tr>
																					<td style="vertical-align: top;" align="left">
																						<table id="tardy" 
																							__gwtcellbasedwidgetimpldispatchingfocus="true"
																							__gwtcellbasedwidgetimpldispatchingblur="true"
																							class="display com-google-gwt-user-cellview-client-CellTable-Style-cellTableWidget"
																							cellspacing="0">
																							<colgroup>
																								<col style="width: 50%;">
																								<col style="width: 50%;">
																							</colgroup>
																							<thead>
																								<tr __gwt_header_row="0">
																									<th colspan="1"
																										class="header firstHeader"
																										__gwt_column="column-gwt-uid-9"
																										__gwt_header="header-gwt-uid-10">Dates
																										Tardy</th>
																									<th colspan="1"
																										class="header lastHeader"
																										__gwt_column="column-gwt-uid-11"
																										__gwt_header="header-gwt-uid-12">Credit</th>
																								</tr>
																							</thead>
																																														<tbody style="">
																								<tr th:each="tardy: ${tardy_dates}" __gwt_row="0" __gwt_subrow="0" class="evenRow">
																									<td class="cell oddCell firstColumn">
																										<div style="outline-style: none;"
																											__gwt_cell="cell-gwt-uid-17" tabindex="0">
																												<span th:text="${tardy.get('day')}"/></div></td>
																									<td class="cell evenCell lastColumn">
																										<div style="outline-style: none;"
																											__gwt_cell="cell-gwt-uid-18">
																											<span th:text="${tardy.get('value')}"/></div></td>
																								</tr>
																							</tbody>
																							<tbody  id="waiting">
																								<tr>
																									<td colspan="2" align="center"><div>
																											<div
																												style="width: 100%; height: 100%; padding: 0px; margin: 0px;">
																												<div style="width: 100%; height: 100%;"></div>
																											</div>
																											<div
																												style="width: 100%; height: 100%; padding: 0px; margin: 0px;">
																												<div
																													style="width: 100%; height: 100%;"
																													class="loading"
																													aria-hidden="false">
																													<img
																														src="data:image/gif;base64,R0lGODlhKwALAPEAAP///0tKSqampktKSiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAKwALAAACMoSOCMuW2diD88UKG95W88uF4DaGWFmhZid93pq+pwxnLUnXh8ou+sSz+T64oCAyTBUAACH5BAkKAAAALAAAAAArAAsAAAI9xI4IyyAPYWOxmoTHrHzzmGHe94xkmJifyqFKQ0pwLLgHa82xrekkDrIBZRQab1jyfY7KTtPimixiUsevAAAh+QQJCgAAACwAAAAAKwALAAACPYSOCMswD2FjqZpqW9xv4g8KE7d54XmMpNSgqLoOpgvC60xjNonnyc7p+VKamKw1zDCMR8rp8pksYlKorgAAIfkECQoAAAAsAAAAACsACwAAAkCEjgjLltnYmJS6Bxt+sfq5ZUyoNJ9HHlEqdCfFrqn7DrE2m7Wdj/2y45FkQ13t5itKdshFExC8YCLOEBX6AhQAADsAAAAAAAAAAAA="
																														class="gwt-Image" width="43" height="11">
																												</div>
																											</div>
																										</div></td>
																								</tr>
																							</tbody>
																							<tfoot style="display: none;" aria-hidden="true"></tfoot>
																						</table>
																					</td>
																				</tr>
																			</tbody>
																		</table>
																	</td>
																</tr>
															</tbody>
														</table></td>
												</tr>
												<tr>
													<td style="vertical-align: top;" align="left"><div
															class="gwt-Label"></div></td>
												</tr>
											</tbody>
										</table>
									</div></td>
							</tr>
						</tbody>
					</table>
				</td>
				<td style="vertical-align: top;" align="left"><table
						class="gwt-DecoratedStackPanel" style="width: 200px;"
						cellspacing="0" cellpadding="0">
						<tbody></tbody>
					</table></td>
			</tr>
		</tbody>
	</table>
	<div id="feedback"></div>
</div>
</div>

<script>
function loadPage() {
	//alert("page is loaded");
	 
	
	fire_ajax_submit();
	var x = $("#goal").html();
	console.log("x = " + x);
	if (x === "0") {
		console.log("redirect");
		//window.location.replace("/greetingload");
		//setTimeout("location.href = 'greetingload';",1500);
		
	}
	else {
		console.log("hide waiting");
		document.getElementById("waiting").style.display = "none";
		
		$(document).ready(function() {
		    $('#present').DataTable({
		    	"order": [ 0,"desc" ]
		    });
		} );
		
		$(document).ready(function() {
		    $('#tardy').DataTable({"order": [ 0,"desc" ]});
		} );
	}
  
}

function fire_ajax_submit() {

    var campusId = $("#campusId").html();
    var url = "@server.servlet.context-path@/greeting/" + campusId;

    $.ajax({
    	url: url,
    	success: function(data) {
    		/*
            var json = "<h4>Ajax Response</h4>&lt;pre&gt;"
                + JSON.stringify(data, null, 4) + "&lt;/pre&gt;";
            $('#feedback').html(json);
            */
            
            $('#goal').html(data.goal);
            $('#present_sum').html(data.presentSum);
            $('#tardy_sum').html(data.tardySum);
            
            var dtf = new Intl.DateTimeFormat('en', { year: 'numeric', month: '2-digit', day: '2-digit' }) 
            
            var dataSet = new Array();
            for (i = 0; i < data.presentDates.length; i++) {
	            var day = new Date(data.presentDates[i].day + "T00:00:00");
	            var [{ value: mo },,{ value: da },,{ value: ye }] = dtf.formatToParts(day)
	            dataSet.push([`${ye}-${mo}-${da}`,data.presentDates[i].value]);
            }
            
            $('#present').DataTable( {
                "data": dataSet,
                "columns": [
                	{ "title": "Dates Present" },
                	{ "title": "Credit" }
            	]
            } );
            
            dataSet = new Array();
            for (i = 0; i < data.tardyDates.length; i++) {
	            var day = new Date(data.tardyDates[i].day);
	            var [{ value: mo },,{ value: da },,{ value: ye }] = dtf.formatToParts(day)
	            dataSet.push([`${ye}-${mo}-${da}`,data.tardyDates[i].value]);
            }
            
            document.getElementById("waiting").style.display = "none";
            
            $('#tardy').DataTable( {
                "data": dataSet,
                "columns": [
                	{ "title": "Dates Tardy" },
                	{ "title": "Credit" }
            	]
            } );
            
            $('#total').html(data.tardySum+data.presentSum);
    	}
    });

}

</script>

</body>
</html>